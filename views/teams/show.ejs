<h1><%= team.teamName %></h1>
<a href="/players/new">Add a Player</a>
<a href="/teams/<%= team._id %>/games/new">Add a Game</a>

<table>
    <tr>
        <th>Game ID</th>
        <th>Home Team</th>
        <th>Away Team</th>
        <th>Date</th>
        <th>Time</th>
    </tr>
    <% for(let game of games) { %>
        <tr>
            <td><%= game._id %></td>
            <td><%= game.homeTeamName %></td>
            <td><%= game.awayTeamName %></td>
            <td><%= game.date %></td>
            <td><%= game.time %></td>
        </tr>
    <% } %>
</table>

<table>
    <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>AVG</th>
        <th>OBP</th>
        <th>SLG</th>
        <th>OPS</th>
        <th>AB</th>
        <th>R</th>
        <th>H</th>
        <th>RBI</th>
        <th>1B</th>
        <th>2B</th>
        <th>3B</th>
        <th>HR</th>
        <th>XBH</th>
        <th>K</th>
        <th>BB</th>
    </tr>
    <% for (let player of players) { %>
        <tr>
            <td><%= player.firstName %></td>
            <td><%= player.lastName %></td>
            <td><%= player.battingAverage.toFixed(3) %></td>
            <td><%= player.onBasePercentage.toFixed(3) %></td>  
            <td><%= player.sluggingPercentage.toFixed(3) %></td>
            <td><%= player.ops %></td>
            <td><%= player.atBats %></td>
            <td><%= player.runs %></td>
            <td><%= player.hits %></td>
            <td><%= player.rbi %></td>
            <td><%= player.single %></td>
            <td><%= player.double %></td>
            <td><%= player.triple %></td>
            <td><%= player.homeRun %></td>
            <td><%= player.xbh %></td>
            <td><%= player.strikeouts %></td>
            <td><%= player.walks %></td>
        </tr>
    <% } %>
    <%
        let teamTotals = {
            atBats     : 0,
            runs       : 0,
            hits       : 0,
            rbi        : 0,
            single     : 0,
            double     : 0,
            triple     : 0,
            homeRun    : 0,
            xbh        : 0,
            strikeouts : 0,
            walks      : 0
        };

        players.forEach(player => Object.keys(teamTotals).forEach(key => teamTotals[key] += player[key]))
        teamTotals.avg = teamTotals.hits / teamTotals.atBats;
        teamTotals.obp = (teamTotals.hits + teamTotals.walks) / (teamTotals.atBats + teamTotals.walks);
        teamTotals.slg = (teamTotals.single * 1 + teamTotals.double * 2 + teamTotals.triple * 3 + teamTotals.homeRun * 4) / teamTotals.atBats;
        teamTotals.ops = teamTotals.obp + teamTotals.slg;
    %>
    <tr>
        <td></td>
        <td><strong>Totals</strong></td>
        <td><strong><%= teamTotals.avg.toFixed(3) %></strong></td>
        <td><strong><%= teamTotals.obp.toFixed(3) %></strong></td>
        <td><strong><%= teamTotals.slg.toFixed(3) %></strong></td>
        <td><strong><%= teamTotals.ops.toFixed(3) %></strong></td>
        <td><strong><%= teamTotals.atBats %></strong></td>
        <td><strong><%= teamTotals.runs %></strong></td>
        <td><strong><%= teamTotals.hits %></strong></td>
        <td><strong><%= teamTotals.rbi %></strong></td>
        <td><strong><%= teamTotals.single %></strong></td>
        <td><strong><%= teamTotals.double %></strong></td>
        <td><strong><%= teamTotals.triple %></strong></td>
        <td><strong><%= teamTotals.homeRun %></strong></td>
        <td><strong><%= teamTotals.xbh %></strong></td>
        <td><strong><%= teamTotals.strikeouts %></strong></td>
        <td><strong><%= teamTotals.walks %></strong></td>
    </tr>
</table>

